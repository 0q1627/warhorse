{% for vm in warhorse.vm %}
{% if vm.nighthawk.cdn is defined %}
{% for cdn in vm.nighthawk.cdn|selectattr("provider", "equalto", "aws" ) %}
{% if cdn.provider == 'aws' %}
${yamlencode({
  "aws_hostnames": [for domain_name in aws-cdn : "${domain_name}"],
{% for vm in warhorse.vm %}
{% for name in dns|selectattr("name", "equalto", vm.name ) %}
{% for entrys in name.entrys %}
{% if entrys.provider == "aws"%}
  "aws_dns_key_id": "${aws-dns-key-id}"
  "aws_dns_key_secret_id": "${aws-dns-secret-id}"
{% endif %}
{% endfor %}
{% endfor %}
{% endfor %}
})}
{% endif %}
{% endfor %}
{% endif %}
{% endfor %}